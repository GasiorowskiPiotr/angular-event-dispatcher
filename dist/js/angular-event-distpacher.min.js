var evilduck;!function(t){var e=function(){function t(t,e){void 0===e&&(e=null),this._func=t,this._guid=e}return t.prototype.wrap=function(t,e){var n=t.defer();try{var i=this._func(e);n.resolve(i)}catch(r){n.reject(r)}return n.promise},Object.defineProperty(t.prototype,"guid",{get:function(){return this._guid},enumerable:!0,configurable:!0}),t}();t.BasicSubscription=e}(evilduck||(evilduck={}));var evilduck;!function(t){var e=function(){function e(t){this._innerDict={},this.$q=t}return e.prototype.on=function(e,n,i){if(void 0===i&&(i=null),!e)throw new Error("Event name must not be empty");if(!n)throw new Error("Handler must be defined");this._innerDict[e]||(this._innerDict[e]=new t.EventSubscription(e));var r=this._innerDict[e].subscribe(n,i);return r.Dispatcher=this,r},e.prototype.ngOn=function(t,e,n,i){void 0===i&&(i=null);var r=this.on(e,n,i);t.$on("destroy",function(){r.destoy()})},e.prototype.unsubscribe=function(t,e,n){void 0===n&&(n=null),this._innerDict[e]&&(this._innerDict[e].unsubscribe(t,n),0===this._innerDict[e].count&&delete this._innerDict[e])},e.prototype.dispatch=function(t,e,n){return void 0===n&&(n=null),this._innerDict[e]?this._innerDict[e].wrap(this.$q,t,n):this.$q.when()},e}();t.EventDispatcher=e;var n=function(){function t(t,e,n){void 0===n&&(n=null),this.event=e,this.tag=n,this.isDestroyed=!1}return t.prototype.destoy=function(){this.isDestroyed||(this.dispatcher.unsubscribe(this.guid,this.event,this.tag),this.isDestroyed=!0)},Object.defineProperty(t.prototype,"Dispatcher",{get:function(){return this.dispatcher},set:function(t){this.dispatcher=t},enumerable:!0,configurable:!0}),t}();t.SubscriptionInfo=n}(evilduck||(evilduck={}));var evilduck;!function(t){var e=function(){function e(t){this._eventName=t,this._tagSubs=new Array,this._subs=new Array}return Object.defineProperty(e.prototype,"eventName",{get:function(){return this._eventName},enumerable:!0,configurable:!0}),e.prototype.subscribe=function(t,e){return void 0===e&&(e=null),this.subscribeGeneral(t,e)},e.prototype.subscribeBasic=function(e,n){void 0===n&&(n=null);var i=this.createGuid();return n?(this._tagSubs.push(t.TagSubscription.Basic(n,e,i)),new t.SubscriptionInfo(i,this._eventName,n)):(this._subs.push(new t.BasicSubscription(e,i)),new t.SubscriptionInfo(i,this._eventName))},e.prototype.subscribePromise=function(e,n){void 0===n&&(n=null);var i=this.createGuid();return n?(this._tagSubs.push(t.TagSubscription.Promise(n,e,i)),new t.SubscriptionInfo(i,this._eventName,n)):(this._subs.push(new t.PromiseSubscription(e,i)),new t.SubscriptionInfo(i,this._eventName))},e.prototype.subscribeGeneral=function(e,n){void 0===n&&(n=null);var i=this.createGuid();return n?(this._tagSubs.push(t.TagSubscription.General(n,e,i)),new t.SubscriptionInfo(i,this._eventName,n)):(this._subs.push(new t.GeneralSubscription(e,i)),new t.SubscriptionInfo(i,this._eventName))},e.prototype.wrap=function(t,e,n){void 0===n&&(n=null);var i,r;n?(i=new Array,r=_.filter(this._tagSubs,function(t){return t.tagName===n})):(i=this._subs,r=this._tagSubs);var u=_.union(i,r);if(0==u.length)return t.when();var o=_.map(u,function(n){return n.wrap(t,e)});return t.all(o)},e.prototype.unsubscribe=function(t,e){if(void 0===e&&(e=null),e){var n=_.find(this._tagSubs,function(n){return n.tagName===e&&n.guid===t}),i=_.indexOf(this._tagSubs,n);this._tagSubs.splice(i,1)}else{var r=_.find(this._subs,function(e){return e.guid===t}),u=_.indexOf(this._subs,r);this._subs.splice(u,1)}},Object.defineProperty(e.prototype,"count",{get:function(){return this._subs.length+this._tagSubs.length},enumerable:!0,configurable:!0}),e.prototype.createGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"===t?e:3&e|8;return n.toString(16)})},e}();t.EventSubscription=e}(evilduck||(evilduck={}));var evilduck;!function(t){var e=function(){function t(t,e){void 0===e&&(e=null),this._func=t,this._guid=e}return t.prototype.wrap=function(t,e){return t.when(this._func(e))},Object.defineProperty(t.prototype,"guid",{get:function(){return this._guid},enumerable:!0,configurable:!0}),t}();t.GeneralSubscription=e}(evilduck||(evilduck={})),angular.module("evilduck.eventDispatcher",[]).service("eventDispatcher",["$q",function(t){return new evilduck.EventDispatcher(t)}]);var evilduck;!function(t){var e=function(){function t(t,e){void 0===e&&(e=null),this._func=t,this._guid=e}return t.prototype.wrap=function(t,e){return this._func(e)},Object.defineProperty(t.prototype,"guid",{get:function(){return this._guid},enumerable:!0,configurable:!0}),t}();t.PromiseSubscription=e}(evilduck||(evilduck={}));var evilduck;!function(t){var e=function(){function e(){}return e.Basic=function(n,i,r){void 0===r&&(r=null);var u=new e;return u._sub=new t.BasicSubscription(i,r),u._tagName=n,u},e.Promise=function(n,i,r){void 0===r&&(r=null);var u=new e;return u._sub=new t.PromiseSubscription(i,r),u._tagName=n,u},e.General=function(n,i,r){void 0===r&&(r=null);var u=new e;return u._sub=new t.GeneralSubscription(i,r),u._tagName=n,u},Object.defineProperty(e.prototype,"tagName",{get:function(){return this._tagName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subscription",{get:function(){return this._sub},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"guid",{get:function(){return this._guid},enumerable:!0,configurable:!0}),e.prototype.wrap=function(t,e){return this._sub.wrap(t,e)},e}();t.TagSubscription=e}(evilduck||(evilduck={}));